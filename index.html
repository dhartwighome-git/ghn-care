<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Majas GHN Care - Nachbarschaftshilfe - F√ºr Dich da!</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
        import { getFirestore, collection, doc, getDocs, addDoc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBv7_fz-X9GtsuTNu-yII4d72So6F24eDk",
            authDomain: "ghn-care.firebaseapp.com",
            projectId: "ghn-care",
            storageBucket: "ghn-care.firebasestorage.app",
            messagingSenderId: "1037138646761",
            appId: "1:1037138646761:web:356baadc89cd4cb1250278"
            };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const form = document.getElementById("login-form");
        const errorEl = document.getElementById("login-error");
        const emailEl = document.getElementById("user-email");
        const logoutBtn = document.getElementById("logout-btn");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            try {
                await signInWithEmailAndPassword(auth, email, password);
                form.reset();
            } catch (err) {
                errorEl.textContent = err.message;
            }
        });

        logoutBtn.addEventListener("click", async () => {
            await signOut(auth);
        });

        // Protect page
        onAuthStateChanged(auth, (user) => {
            const isLoggedIn = !!user;

            document.body.classList.toggle("logged-in", isLoggedIn);
            document.body.classList.toggle("logged-out", !isLoggedIn);

            if (isLoggedIn) {
                emailEl.textContent = `Logged in as: ${user.email}`;
            }
        });

        // Optional globals
        window.app = app;
        window.auth = auth;
        
        // Header animation
        const SCROLL_THRESHOLD = 50;

        window.addEventListener('scroll', () => {
            if (window.scrollY > SCROLL_THRESHOLD) {
            document.body.classList.add('scrolled');
            } else {
            document.body.classList.remove('scrolled');
            }
        });

        // Fill reviews container
        const reviewsContainer = document.getElementById("text-container-reviews");

        // Fetch reviews
        const reviews = getReviews();
        console.log(reviews)

        async function getReviews() {
            const snapshot = await getDocs(collection(db, "reviews"));

            snapshot.forEach(doc => {
                const data = doc.data();
                const reviewBox = createReviewBox(data);
                reviewsContainer.appendChild(reviewBox);
            })
        }

        function createReviewBox(data) {
            // Fill reviews container
            /* Data:
                - gender*
                - firstName*
                - lastName*
                - email*
                - birthday*
                - title*
                - message*
            */
            const box = document.createElement("div");
            box.className = "text-container";

            // Title
            const reviewTitle = document.createElement("h3");
            reviewTitle.className = "review-title"
            reviewTitle.textContent = data.reviewTitle || "";

            const message = document.createElement("p");
            message.className = "review-message";
            message.textContent = data.message || "";

            // Person: "Herr H. Grafen, 70 J."
            const person = document.createElement("p");
            person.className = "review-person";

            // Title
            const personTitle = data.personTitle ?? "";

            // First Name
            const firstInitial = data.firstName?.[0] ?? "";

            // Last Name
            const lastName = data.lastName ?? "";

            // Age
            const age = calculateAge(data.birthday);
            const ageText = Number.isInteger(age) ? ` ${age} J.` : "";

            person.textContent = `${personTitle} ${firstInitial}. ${lastName}, ${ageText}`.trim();

            box.append(reviewTitle, message, person);
            return box;
        }

        function calculateAge(birthday) {
            let birthDate;

            if (!birthday) return null;

            // Firestore Timestamp
            if (birthday.toDate) {
                birthDate = birthday.toDate();
            }
            // String or Date
            else {
                birthDate = new Date(birthday);
            }

            const today = new Date();
            let age = today.getFullYear() - birthDate.getFullYear();

            const hasHadBirthdayThisYear =
                today.getMonth() > birthDate.getMonth() ||
                (today.getMonth() === birthDate.getMonth() &&
                today.getDate() >= birthDate.getDate());

            if (!hasHadBirthdayThisYear) {
                age--;
            }

            return age;
        }

    </script>

    <header>
        <!--Logo & Links-->
        <div class="logo"><img src="Logo10.png"></div>
        <div class="sign-in">
            <form id="login-form">
                <input type="email" id="email" placeholder="Email" required>
                <input type="password" id="password" placeholder="Password" required>
                <button type="submit">Login</button>
                <p id="login-error"></p>
            </form>
            <div id="auth-status" class="auth protected flex">
                <span id="user-email"></span>
                <button id="logout-btn">Logout</button>
            </div>
        </div>
    </header>

    <main>
        <div class="container" id="container-top">

            <div class="text-container">
                <h2>Mein Leitbild</h2>
                <p>Ich m√∂chte Dich gerne im Alltag begleiten, unterst√ºtzen und mit Dir Zeit verbringen, denn das entspricht meinen christlichen Werten.</p>
            </div>

            <div class="title">
                <h1>Zeit f√ºr Dich!</h1>
            </div>

        </div>

        <div class="container" id="container-services">

            <div class="title">
                <h1>Meine Dienstleistungen</h1>
            </div>

            <div class="container-service" id="service1">
                <div class="text-container">
                    <!--Gespr√§che und Gesellschaft: Musik-->
                    <img src="Icons/partner_heart.png">
                    <h2>Gespr√§che</h2>
                    <p>Du hast etwas auf dem Herzen? Ich bin Dein Ansprechpartner und habe immer ein offenes Ohr f√ºr Dich.</p>
                </div>
            </div>

            <div class="container-service" id="service2">
                <div class="text-container">
                    <img src="Icons/car_shuttle.png">
                    <h2>Fahrdienst</h2>
                    <p>Du bist nicht mehr so gut zu Fu√ü oder das Taxi ist zu teuer? Das ist kein Problem. Ich begleite Dich zu Deinen Terminen und helfe Dir mit Deinem Einkauf.</p>
                </div>
            </div>
            
            <div class="container-service" id="service3">
                <div class="text-container">
                    <img src="Icons/forest.png">
                    <h2>Ausfl√ºge</h2>
                    <p>Du m√∂chtest an die frische Luft oder warst schon l√§nger nicht mehr im Tierpark? Gemeinsam k√∂nnen wir etwas unternehmen.</p>
                </div>
            </div>

            <div class="container-service" id="service4">
                <div class="text-container">
                    <img src="Icons/cleaning_bottle.png">
                    <h2>Haushalt</h2>
                    <p>Das Geschirr stapelt sich oder Du m√∂chtest gerne etwas essen? Ich erledige grundlegende Arbeiten wie eine flei√üige üêù.</p>
                </div>
            </div>
            <!--uvm.-->
        </div>

        <div class="container" id="container-about-me">

            <img src="Maja_Photo.JPG" class="protected">

            <div class="text-container">
                <h1>√úber mich</h2>
                <p>Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.</p>
            </div>

        </div>

        <div class="container" id="container-reviews">
            <div class="title">
                <h1>Bewertungen</h1>
            </div>

            <div id="text-container-reviews">
                <!--Insert from database HERE-->
            </div>

            <!--To do: New review form-->

        </div>

        <div class="container" id="container-video">
            <div class="title">
                <h1>Meine Arbeit</h1>
            </div>

            <!--Video-->

        </div>

        <div class="container" id="container-contact">
            <div class="title">
                <h1>Kontakt</h1>
            </div>

            <!--Contact form-->

        </div>
    </main>

    <footer>
        <!--Impressum-->
        <div class="copyright">
            ¬© erstellt von David Hartwig 2026
        </div>

    </footer>
    
</body>
</html>